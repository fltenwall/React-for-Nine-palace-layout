<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        .box {width: 320px;height: 600px;background: url("images/bg.jpg") no-repeat;margin: 30px auto;}
        .top {height: 60px;display: flex;justify-content: space-around;align-items: center;}
        .top button {border: none;width: 100px;height: 36px;border-radius: 5px;color: #fff;}
        .top button:first-child {background-color: orange;}
        .top button:last-child {background-color: orangered;}
        .bottom {width: 96%;height: 70%;margin-top: 15px;background-color: transparent;position: relative;margin-left: 2%;}
        .item {display: flex;flex-direction: column;justify-content: center;align-items: center;position: absolute;}
        span{font-size: 12px;}
        .selectNum{text-align: center;color: white}
        select{width: 120px;text-align: center}
    </style>
</head>
<body>
<div id="root"></div>

<!--<div class="main">我是一个盒子</div>-->

<script src="./../js/react.development.js"></script>
<script src="./../js/react-dom.development.js"></script>
<script src="./../js/prop-types.js"></script>
<script src="./../js/babel.js"></script>
<script type="text/babel">
     class Box extends React.Component{
          constructor(){
              super();

              // 1. 初始化状态
              this.state = {
                  // 1.1 数据
                  dataArr: [
                      {"icon": "f1", "name": "番茄"},
                      {"icon": "f2", "name": "苹果"},
                      {"icon": "f3", "name": "水蜜桃"},
                      {"icon": "f4", "name": "香蕉"},
                      {"icon": "f5", "name": "蓝莓"},
                      {"icon": "f6", "name": "菠萝"},
                      {"icon": "f7", "name": "草莓"},
                      {"icon": "f8", "name": "猕猴桃"},
                      {"icon": "f9", "name": "橙子"},
                      {"icon": "f1", "name": "番茄"},
                      {"icon": "f2", "name": "苹果"},
                      {"icon": "f3", "name": "水蜜桃"},
                      {"icon": "f4", "name": "香蕉"},
                      {"icon": "f5", "name": "蓝莓"},
                      {"icon": "f6", "name": "菠萝"},
                      {"icon": "f7", "name": "草莓"},
                      {"icon": "f8", "name": "猕猴桃"},
                      {"icon": "f9", "name": "橙子"},
                      {"icon": "f1", "name": "番茄"},
                      {"icon": "f2", "name": "苹果"},
                      {"icon": "f3", "name": "水蜜桃"},
                      {"icon": "f4", "name": "香蕉"},
                      {"icon": "f5", "name": "蓝莓"},
                      {"icon": "f6", "name": "菠萝"},
                      {"icon": "f7", "name": "草莓"},
                      {"icon": "f8", "name": "猕猴桃"},
                      {"icon": "f9", "name": "橙子"},
                      {"icon": "f1", "name": "番茄"},
                      {"icon": "f2", "name": "苹果"},
                      {"icon": "f3", "name": "水蜜桃"},
                      {"icon": "f4", "name": "香蕉"},
                      {"icon": "f5", "name": "蓝莓"},
                      {"icon": "f6", "name": "菠萝"},
                      {"icon": "f7", "name": "草莓"},
                      {"icon": "f8", "name": "猕猴桃"},
                      {"icon": "f9", "name": "橙子"},
                      {"icon": "f1", "name": "番茄"},
                      {"icon": "f2", "name": "苹果"},
                      {"icon": "f3", "name": "水蜜桃"},
                      {"icon": "f4", "name": "香蕉"},
                      {"icon": "f5", "name": "蓝莓"},
                      {"icon": "f6", "name": "菠萝"},
                      {"icon": "f7", "name": "草莓"},
                      {"icon": "f8", "name": "猕猴桃"},
                      {"icon": "f9", "name": "橙子"},
                      {"icon": "f1", "name": "番茄"},
                      {"icon": "f2", "name": "苹果"},
                      {"icon": "f3", "name": "水蜜桃"},
                      {"icon": "f4", "name": "香蕉"},
                      {"icon": "f5", "name": "蓝莓"},
                      {"icon": "f6", "name": "菠萝"},
                      {"icon": "f7", "name": "草莓"},
                      {"icon": "f8", "name": "猕猴桃"},
                      {"icon": "f9", "name": "橙子"},
                      {"icon": "f1", "name": "番茄"},
                      {"icon": "f2", "name": "苹果"},
                      {"icon": "f3", "name": "水蜜桃"},
                      {"icon": "f4", "name": "香蕉"},
                      {"icon": "f5", "name": "蓝莓"},
                      {"icon": "f6", "name": "菠萝"},
                      {"icon": "f7", "name": "草莓"},
                      {"icon": "f8", "name": "猕猴桃"},
                      {"icon": "f9", "name": "橙子"},
                      {"icon": "f1", "name": "番茄"},
                      {"icon": "f2", "name": "苹果"},
                      {"icon": "f3", "name": "水蜜桃"},
                      {"icon": "f4", "name": "香蕉"},
                      {"icon": "f5", "name": "蓝莓"},
                      {"icon": "f6", "name": "菠萝"},
                      {"icon": "f7", "name": "草莓"},
                      {"icon": "f8", "name": "猕猴桃"},
                      {"icon": "f9", "name": "橙子"},
                      {"icon": "f2", "name": "苹果"},
                      {"icon": "f3", "name": "水蜜桃"},
                      {"icon": "f4", "name": "香蕉"},
                      {"icon": "f5", "name": "蓝莓"},
                      {"icon": "f6", "name": "菠萝"},
                      {"icon": "f7", "name": "草莓"},
                      {"icon": "f8", "name": "猕猴桃"},
                      {"icon": "f9", "name": "橙子"},
                      {"icon": "f8", "name": "猕猴桃"},
                      {"icon": "f9", "name": "橙子"},
                  ],
                  // 1.2 水果组件数组
                  itemArr: [],
                  selectVal : 3,
                  count : 0,
              };
          }

         _addItem(){
              //0.使用默认布局时要改变count值
              if(this.state.selectVal === 3){
                  let {count} = this.state;
                  let temp =  1;
                  this.setState({
                      count:temp
                  });
              }

             // 1. 变量
             let cols = Number(this.state.selectVal), itemW = 80/(cols/3), itemH = 100/(cols/3), boxW = 320, boxH = 400;
             // 2. 求出水平和垂直间距
             let xMargin = (boxW - cols * itemW) / cols;
             let yMargin = (boxH - cols * itemH) / (cols - 1);

             // 3. 根据水果盒子的下标确定所在的行和列
             let index = this.state.itemArr.length;
             console.log(index);

             if(index >= this.state.selectVal * this.state.selectVal){
                 alert('购物车已经满了！');
                 return;
             }


             let row = Math.floor(index / cols);
             let col = index % cols;
             console.log(row, col);

             // 4. 求出水果盒子左边和上边尺寸
             let left = col * (itemW + xMargin);
             let top = row * (itemH + yMargin);

             // 5. 创建组件装入数组
             const {dataArr} = this.state;
             let itemView = (
                 <div className="item" key={index} style={{left, top}}>
                     <img src={`images/${dataArr[index].icon}.png`} alt="" style={{width: itemW}} />
                     <span>{dataArr[index].name}</span>
                 </div>
             );

             // 6. 更新状态机
             let tempArr = this.state.itemArr;
             tempArr.push(itemView);
             this.setState({
                 itemArr: tempArr
             })

         }

         _removeItem(){
             let index = this.state.itemArr.length;
             if(index <= 0){
                 alert('购物车空了！');
                 return;
             }

             // 删除
             let tempArr = this.state.itemArr;
             tempArr.pop();

             // 更新状态机
             this.setState({
                itemArr: tempArr
             })
         }

         _getSelectVal(val,e){
              this.state.count+=1;
              //布局非法改变时仍然使用原来的布局
              if(this.state.count < 2){
                  let {selectVal} = this.state;
                  selectVal = val;
                  this.setState({
                      selectVal
                  });
              }else{
                  alert('中途不能更换布局方式！');
                  //确保非法改变布局被阻止后下拉框选中的值为原来的值
                  e.target.value = this.state.selectVal;
                  return false;
              }

         }

          render(){
              return (
                  <div className="box">
                      <div className="selectNum">
                          <label>
                              请选择布局方式:
                                  <select onChange={(e)=>{this._getSelectVal(e.target.value,e)}} defaultValue={this.state.selectVal}>
                                  <option value="1">1</option>
                                  <option value="2">2</option>
                                  <option value="3">3</option>
                                  <option value="4">4</option>
                                  <option value="5">5</option>
                                  <option value="6">6</option>
                                  <option value="7">7</option>
                                  <option value="8">8</option>
                                  <option value="9">9</option>
                              </select>
                          </label>
                      </div>
                      {/*上部分*/}
                       <div className="top">
                           <button onClick={()=>this._addItem()}>添加</button>
                           <button onClick={()=>this._removeItem()}>删除</button>
                       </div>
                      {/*下部分*/}
                      <div className="bottom">
                          {this.state.itemArr}
                      </div>
                  </div>
              )
          }
     }

     ReactDOM.render(<Box />, root);
</script>
</body>
</html>
